/* esm.sh - esbuild bundle(openai@4.67.2/lib/EventStream) denonext production */
import{APIUserAbortError as S,OpenAIError as p}from"/v135/openai@4.67.2/denonext/error.js";var a=function(n,t,e,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?n!==t||!r:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(n,e):r?r.value=e:t.set(n,e),e},s=function(n,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?n!==t||!i:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(n):i?i.value:t.get(n)},P,_,d,f,c,w,l,o,m,u,E,h,v,b=class{constructor(){P.add(this),this.controller=new AbortController,_.set(this,void 0),d.set(this,()=>{}),f.set(this,()=>{}),c.set(this,void 0),w.set(this,()=>{}),l.set(this,()=>{}),o.set(this,{}),m.set(this,!1),u.set(this,!1),E.set(this,!1),h.set(this,!1),a(this,_,new Promise((t,e)=>{a(this,d,t,"f"),a(this,f,e,"f")}),"f"),a(this,c,new Promise((t,e)=>{a(this,w,t,"f"),a(this,l,e,"f")}),"f"),s(this,_,"f").catch(()=>{}),s(this,c,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},s(this,P,"m",v).bind(this))},0)}_connected(){this.ended||(s(this,d,"f").call(this),this._emit("connect"))}get ended(){return s(this,m,"f")}get errored(){return s(this,u,"f")}get aborted(){return s(this,E,"f")}abort(){this.controller.abort()}on(t,e){return(s(this,o,"f")[t]||(s(this,o,"f")[t]=[])).push({listener:e}),this}off(t,e){let i=s(this,o,"f")[t];if(!i)return this;let r=i.findIndex(W=>W.listener===e);return r>=0&&i.splice(r,1),this}once(t,e){return(s(this,o,"f")[t]||(s(this,o,"f")[t]=[])).push({listener:e,once:!0}),this}emitted(t){return new Promise((e,i)=>{a(this,h,!0,"f"),t!=="error"&&this.once("error",i),this.once(t,e)})}async done(){a(this,h,!0,"f"),await s(this,c,"f")}_emit(t,...e){if(s(this,m,"f"))return;t==="end"&&(a(this,m,!0,"f"),s(this,w,"f").call(this));let i=s(this,o,"f")[t];if(i&&(s(this,o,"f")[t]=i.filter(r=>!r.once),i.forEach(({listener:r})=>r(...e))),t==="abort"){let r=e[0];!s(this,h,"f")&&!i?.length&&Promise.reject(r),s(this,f,"f").call(this,r),s(this,l,"f").call(this,r),this._emit("end");return}if(t==="error"){let r=e[0];!s(this,h,"f")&&!i?.length&&Promise.reject(r),s(this,f,"f").call(this,r),s(this,l,"f").call(this,r),this._emit("end")}}_emitFinal(){}};_=new WeakMap,d=new WeakMap,f=new WeakMap,c=new WeakMap,w=new WeakMap,l=new WeakMap,o=new WeakMap,m=new WeakMap,u=new WeakMap,E=new WeakMap,h=new WeakMap,P=new WeakSet,v=function(t){if(a(this,u,!0,"f"),t instanceof Error&&t.name==="AbortError"&&(t=new S),t instanceof S)return a(this,E,!0,"f"),this._emit("abort",t);if(t instanceof p)return this._emit("error",t);if(t instanceof Error){let e=new p(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new p(String(t)))};export{b as EventStream};
//# sourceMappingURL=EventStream.js.map