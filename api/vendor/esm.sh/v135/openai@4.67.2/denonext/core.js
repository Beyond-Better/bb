/* esm.sh - esbuild bundle(openai@4.67.2/core) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import{VERSION as l}from"/v135/openai@4.67.2/denonext/version.js";import{Stream as B}from"/v135/openai@4.67.2/denonext/streaming.js";import{OpenAIError as f,APIError as N,APIConnectionError as M,APIConnectionTimeoutError as T,APIUserAbortError as S}from"/v135/openai@4.67.2/denonext/error.js";import{kind as V,getDefaultAgent as v,fetch as F}from"/v135/openai@4.67.2/denonext/_shims.js";import{isBlobLike as W,isMultipartBody as P}from"/v135/openai@4.67.2/denonext/uploads.js";import{maybeMultipartFormRequestOptions as Ae,multipartFormRequestOptions as Ee,createForm as Oe}from"/v135/openai@4.67.2/denonext/uploads.js";var H=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},U=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},g;async function I(t){let{response:e}=t;if(t.options.stream)return y("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):B.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;let r=e.headers.get("content-type");if(r?.includes("application/json")||r?.includes("application/vnd.api+json")){let o=await e.json();return y("response",e.status,e.url,e.headers,o),X(o,e)}let s=await e.text();return y("response",e.status,e.url,e.headers,s),s}function X(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var w=class t extends Promise{constructor(e,r=I){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=r}_thenUnwrap(e){return new t(this.responsePromise,async r=>X(e(await this.parseResponse(r)),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r,request_id:r.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},q=class{constructor({baseURL:e,maxRetries:r=2,timeout:n=6e5,httpAgent:s,fetch:o}){this.baseURL=e,this.maxRetries=b("maxRetries",r),this.timeout=b("timeout",n),this.httpAgent=s,this.fetch=o??F}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...z(),...this.authHeaders(e)}}validateHeaders(e,r){}defaultIdempotencyKey(){return`stainless-node-retry-${oe()}`}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(async s=>{let o=s&&W(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:r,...s,body:o}}))}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof __Buffer$<"u")return __Buffer$.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:r=0}={}){let{method:n,path:s,query:o,headers:i={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:P(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,h=this.calculateContentLength(a),u=this.buildURL(s,o);"timeout"in e&&b("timeout",e.timeout);let d=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??v(u),p=d+1e3;typeof c?.options?.timeout=="number"&&p>(c.options.timeout??0)&&(c.options.timeout=p),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let m=this.buildHeaders({options:e,headers:i,contentLength:h,retryCount:r});return{req:{method:n,...a&&{body:a},headers:m,...c&&{agent:c},signal:e.signal??null},url:u,timeout:d}}buildHeaders({options:e,headers:r,contentLength:n,retryCount:s}){let o={};n&&(o["content-length"]=n);let i=this.defaultHeaders(e);return _(o,i),_(o,r),P(e.body)&&V!=="node"&&delete o["content-type"],$(r,"x-stainless-retry-count")===void 0&&(o["x-stainless-retry-count"]=String(s)),this.validateHeaders(o,r),o}async prepareOptions(e){}async prepareRequest(e,{url:r,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(r=>[...r])):{...e}:{}}makeStatusError(e,r,n,s){return N.generate(e,r,n,s)}request(e,r=null){return new w(this.makeRequest(e,r))}async makeRequest(e,r){let n=await e,s=n.maxRetries??this.maxRetries;r==null&&(r=s),await this.prepareOptions(n);let{req:o,url:i,timeout:a}=this.buildRequest(n,{retryCount:s-r});if(await this.prepareRequest(o,{url:i,options:n}),y("request",i,n,o.headers),n.signal?.aborted)throw new S;let h=new AbortController,u=await this.fetchWithTimeout(i,o,a,h).catch(C);if(u instanceof Error){if(n.signal?.aborted)throw new S;if(r)return this.retryRequest(n,r);throw u.name==="AbortError"?new T:new M({cause:u})}let d=K(u.headers);if(!u.ok){if(r&&this.shouldRetry(u)){let x=`retrying, ${r} attempts remaining`;return y(`response (error; ${x})`,u.status,i,d),this.retryRequest(n,r,d)}let c=await u.text().catch(x=>C(x).message),p=Y(c),m=p?void 0:c;throw y(`response (error; ${r?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,d,m),this.makeStatusError(u.status,p,m,d)}return{response:u,options:n,controller:h}}requestAPIList(e,r){let n=this.makeRequest(r,null);return new R(this,n,e)}buildURL(e,r){let n=ee(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return L(s)||(r={...s,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(n.search=this.stringifyQuery(r)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([r,n])=>typeof n<"u").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new f(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,r,n,s){let{signal:o,...i}=r||{};o&&o.addEventListener("abort",()=>s.abort());let a=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(a)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n){let s,o=n?.["retry-after-ms"];if(o){let a=parseFloat(o);Number.isNaN(a)||(s=a)}let i=n?.["retry-after"];if(i&&!s){let a=parseFloat(i);Number.isNaN(a)?s=Date.parse(i)-Date.now():s=a*1e3}if(!(s&&0<=s&&s<60*1e3)){let a=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(r,a)}return await te(s),this.makeRequest(e,r-1)}calculateDefaultRetryTimeoutMillis(e,r){let o=r-e,i=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return i*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${l}`}},A=class{constructor(e,r,n,s){g.set(this,void 0),H(this,g,e,"f"),this.options=s,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new f("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let r={...this.options};if("params"in e&&typeof r.query=="object")r.query={...r.query,...e.params};else if("url"in e){let n=[...Object.entries(r.query||{}),...e.url.searchParams.entries()];for(let[s,o]of n)e.url.searchParams.set(s,o);r.query=void 0,r.path=e.url.toString()}return await U(this,g,"f").requestAPIList(this.constructor,r)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(g=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let r of e.getPaginatedItems())yield r}},R=class extends w{constructor(e,r,n){super(r,async s=>new n(e,s.response,await I(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let r of e)yield r}},K=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,r){let n=r.toString();return e[n.toLowerCase()]||e[n]}}),J={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ye=t=>typeof t=="object"&&t!==null&&!L(t)&&Object.keys(t).every(e=>j(J,e)),G=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":O(Deno.build.os),"X-Stainless-Arch":E(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":__Process$.version};if(Object.prototype.toString.call(typeof __Process$<"u"?__Process$:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":O(__Process$.platform),"X-Stainless-Arch":E(__Process$.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":__Process$.version};let t=Q();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":l,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Q(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:r}of t){let n=r.exec(navigator.userAgent);if(n){let s=n[1]||0,o=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${o}.${i}`}}}return null}var E=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",O=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),k,z=()=>k??(k=G()),Y=t=>{try{return JSON.parse(t)}catch{return}},Z=new RegExp("^(?:[a-z]+:)?//","i"),ee=t=>Z.test(t),te=t=>new Promise(e=>setTimeout(e,t)),b=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new f(`${t} must be an integer`);if(e<0)throw new f(`${t} must be a positive integer`);return e},C=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},pe=t=>{if(t==null)throw new f(`Expected a value to be given but received ${t} instead.`);return t},he=t=>{if(typeof __Process$<"u")return __Process$.env?.[t]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(t)?.trim()},re=t=>{if(typeof t=="number")return Math.round(t);if(typeof t=="string")return parseInt(t,10);throw new f(`Could not coerce ${t} (type: ${typeof t}) into a number`)},ne=t=>{if(typeof t=="number")return t;if(typeof t=="string")return parseFloat(t);throw new f(`Could not coerce ${t} (type: ${typeof t}) into a number`)},se=t=>typeof t=="boolean"?t:typeof t=="string"?t==="true":!!t,me=t=>{if(t!==void 0)return re(t)},ge=t=>{if(t!==void 0)return ne(t)},we=t=>{if(t!==void 0)return se(t)};function L(t){if(!t)return!0;for(let e in t)return!1;return!0}function j(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _(t,e){for(let r in e){if(!j(e,r))continue;let n=r.toLowerCase();if(!n)continue;let s=e[r];s===null?delete t[n]:s!==void 0&&(t[n]=s)}}function y(t,...e){typeof __Process$<"u"&&__Process$?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${t}`,...e)}var oe=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),xe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ie=t=>typeof t?.get=="function",be=(t,e)=>{let r=$(t,e);if(r===void 0)throw new Error(`Could not find ${e} header`);return r},$=(t,e)=>{let r=e.toLowerCase();if(ie(t)){let n=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,o,i)=>o+i.toUpperCase());for(let s of[e,r,e.toUpperCase(),n]){let o=t.get(s);if(o)return o}}for(let[n,s]of Object.entries(t))if(n.toLowerCase()===r)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s},Re=t=>{if(!t)return"";if(typeof __Buffer$<"u")return __Buffer$.from(t).toString("base64");if(typeof btoa<"u")return btoa(t);throw new f("Cannot generate b64 string; Expected `Buffer` or `btoa` to be defined")};function Se(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}export{q as APIClient,w as APIPromise,A as AbstractPage,R as PagePromise,C as castToError,se as coerceBoolean,ne as coerceFloat,re as coerceInteger,Oe as createForm,K as createResponseHeaders,y as debug,pe as ensurePresent,$ as getHeader,be as getRequiredHeader,j as hasOwn,L as isEmptyObj,ie as isHeadersProtocol,Se as isObj,ye as isRequestOptions,xe as isRunningInBrowser,we as maybeCoerceBoolean,ge as maybeCoerceFloat,me as maybeCoerceInteger,Ae as maybeMultipartFormRequestOptions,Ee as multipartFormRequestOptions,he as readEnv,Y as safeJSON,te as sleep,Re as toBase64};
//# sourceMappingURL=core.js.map